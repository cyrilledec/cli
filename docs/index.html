<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><link rel="stylesheet" href="/cli/magic.css?Zq69ZfLn2z" integrity="sha384-Zq69ZfLn2zMms7j2K6iZ4EutxfQtqvQdMArbrmWD1ZCTC4BnxZbOaCKwKYosMrdy" crossorigin="anonymous"/><link rel="icon" href="/cli/favicon.ico"/><title>@magic/cli</title><meta name="description" content="declarative cli wrapper for @magic"/><script type="application/ld+json">{"@context":"http://schema.org","@type":"website","name":"@magic/cli"}</script></head><body><a class="SkipLink" href="/cli/#page">Skip to Content</a><main id="Magic"><div class="Wrapper"><header class="Header"><a class="Logo" href="/cli/"><span>@magic/cli</span></a><nav class="Menu"><ul><li><a href="/cli/#install">install</a></li><li><a href="/cli/#caveats">caveats</a></li><li><a href="/cli/#usage">usage</a></li><li><a href="/cli/#argv">argv</a></li><li><a href="/cli/#commands">commands</a></li><li><a href="/cli/#help">help</a></li><li><a href="/cli/#config">configuration</a></li><li><a href="/cli/#source">source</a></li></ul></nav></header><div class="Page" id="page"><h2>@magic/cli</h2><p>declarative cli sanitization and execution for <a href="https://magic.github.io" target="_blank" rel="noopener">@magic</a></p><p>sanitizes cli flags from aliases to default names</p><p>rewrites process.argv accordingly</p><p>provides autogenerated --help output (that can be customized)</p><p>also handles commands and environment for you</p><p>exports a commonjs file that allows to launch mjs files as cli&#39;s</p><ul class="GitBadges"><li><a href="https://www.npmjs.com/package/@magic/cli" target="_blank" rel="noopener"><img src="https://img.shields.io/npm/v/@magic/cli.svg" role="presentation" alt=""/></a></li><li><a href="https://travis-ci.com/magic/cli" target="_blank" rel="noopener"><img src="https://img.shields.io/travis/com/magic/cli/master" role="presentation" alt=""/></a></li><li><a href="https://ci.appveyor.com/project/magic/cli/branch/master" target="_blank" rel="noopener"><img src="https://img.shields.io/appveyor/ci/magic/cli/master.svg" role="presentation" alt=""/></a></li><li><a href="https://coveralls.io/github/magic/cli" target="_blank" rel="noopener"><img src="https://img.shields.io/coveralls/github/magic/cli/master.svg" role="presentation" alt=""/></a></li><li><a href="https://greenkeeper.io" target="_blank" rel="noopener"><img src="https://badges.greenkeeper.io/magic/cli.svg" role="presentation" alt=""/></a></li><li><a href="https://snyk.io/test/github/magic/cli" target="_blank" rel="noopener"><img src="https://img.shields.io/snyk/vulnerabilities/github/magic/cli.svg" role="presentation" alt=""/></a></li></ul><h3 id="install">install</h3><p>be in a nodejs project</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line">npm i --save-dev @magic/cli</code></pre></div><h3 id="caveats">caveats</h3><p>there are some quirks that need some careful consideration when designing a cli api depending on your requirements, these caveats may or may not apply.</p><ol><li><h4>last argument</h4><p>if your last argument does not have a corresponding flag, it will still be assigned to the last flag prior to it.<h5>workaround</h5><p>do not design a cli with a trailing command.</p><p>TODO: add a config bool.</p></p></li><li><h4>option argument and command name clash</h4><p>if one of your options gets an argument that is equal to a command,  this command will be executed<h5>workaround</h5><p>do not name your commands like the possible arguments.</p></p></li><li><h4>flag arguments can not start with a dash</h4><p>cli arguments that start with a - will always be treated as flags, not values.</p><h5>workaround</h5><p>do not design a cli that accepts arguments that start with a -</p></li></ol><p>those issues might get addressed in the future.</p><h3 id="usage">Usage</h3><p>full api example</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line">#!/usr/bin/env node</code><code class="line"></code><code class="line"><span class="comment">// ./<span class="object">bin</span>.<span class="property">js</span></span></code><code class="line"><span class="keyword">const</span> spawnCli = <span class="keyword">require</span>(<span class="string">&#39;@magic/cli&#39;</span>)</code><code class="line"></code><code class="line"><span class="keyword">const</span> argv = [<span class="string">&#39;--flag1&#39;</span>, <span class="string">&#39;--flag2&#39;</span>, <span class="string">&#39;/file/path/<span class="object">cli</span>.<span class="property">mjs</span>&#39;</span>]</code><code class="line"></code><code class="line"><span class="keyword">const</span> cmd = <span class="string">&#39;node&#39;</span> <span class="comment">// <span class="keyword">default</span></span></code><code class="line"></code><code class="line">spawnCli(argv, cmd)</code></pre></div><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="comment">// ./<span class="object">bin</span>.<span class="property">mjs</span></span></code><code class="line"></code><code class="line"><span class="keyword">import</span> cli from <span class="string">&#39;@magic/cli/src/<span class="object">index</span>.<span class="property">mjs</span>&#39;</span><span class="string">&#39;&#39;</span></code><code class="line"></code><code class="line"><span class="keyword">const</span> { argv, env, commands } = cli({</code><code class="line">  <span class="colon">commands</span>: [</code><code class="line">    [<span class="string">&#39;cmd1&#39;</span>, <span class="string">&#39;cmd1alias&#39;</span>],</code><code class="line">    <span class="string">&#39;cmd2&#39;</span>,</code><code class="line">  ],</code><code class="line">  <span class="colon">options</span>: [</code><code class="line">    [<span class="string">&#39;--flag1&#39;</span>, <span class="string">&#39;-f1&#39;</span>],</code><code class="line">    [<span class="string">&#39;--flag2&#39;</span>, <span class="string">&#39;-f2&#39;</span>],</code><code class="line">  ],</code><code class="line">  <span class="colon">default</span>: {</code><code class="line">    <span class="string">&#39;--<span class="keyword">default</span>-key&#39;</span>: <span class="string">&#39;<span class="keyword">default</span>-value&#39;</span>,</code><code class="line">  },</code><code class="line">  <span class="colon">env</span>: [[[<span class="string">&#39;--production&#39;</span>, <span class="string">&#39;--prod&#39;</span>, <span class="string">&#39;--p&#39;</span>, <span class="string">&#39;-p&#39;</span>], <span class="string">&#39;NODE_ENV&#39;</span>, <span class="string">&#39;production&#39;</span>]],</code><code class="line">  <span class="colon">pure</span>: <span class="boolean">true</span>, <span class="comment">// <span class="keyword">do</span> neither change <span class="object">process</span>.<span class="property">argv</span> nor <span class="object">process</span>.<span class="property">env</span></span></code><code class="line">  <span class="colon">pureArgv</span>: <span class="boolean">true</span>, <span class="comment">// <span class="keyword">do</span> not change <span class="object">process</span>.<span class="property">argv</span></span></code><code class="line">  <span class="colon">pureEnv</span>: <span class="boolean">true</span>, <span class="comment">// <span class="keyword">do</span> not change <span class="object">process</span>.<span class="property">env</span></span></code><code class="line">})</code></pre></div><h3 id="argv">options / argv</h3><p>argv mappings will handle options and option aliases</p><p>using the <a href="/cli/#usage">cli file</a> above</p><p>then, in your terminal / bash</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="object">bin</span>.<span class="property">js</span> -f1 arg1 arg2 -f2</code></pre></div><p>resulting process.argv</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="object">process</span>.<span class="property">argv</span> = [</code><code class="line">  <span class="string">&#39;/path/to/bin/node&#39;</span>,</code><code class="line">  &#39;/path/to/<span class="object">bin</span>.<span class="property">js</span>&#39;,</code><code class="line">  <span class="string">&#39;--flag1&#39;</span></code><code class="line">  <span class="string">&#39;arg1&#39;</span>,</code><code class="line">  <span class="string">&#39;arg2&#39;</span>,</code><code class="line">  <span class="string">&#39;--flag2&#39;</span>,</code><code class="line">]</code></pre></div><p>returned javascript object</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line">argv === { <span class="string">&#39;--flag1&#39;</span>: [<span class="string">&#39;arg1&#39;</span>, arg2], <span class="string">&#39;--flag2&#39;</span>: []}</code></pre></div><h3 id="commands">commands</h3><p>cli commands can be handled too.</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">import</span> cli from <span class="string">&#39;@magic/cli/src/<span class="object">index</span>.<span class="property">mjs</span>&#39;</span><span class="string">&#39;&#39;</span></code><code class="line"></code><code class="line"><span class="keyword">const</span> args = {</code><code class="line">  <span class="colon">commands</span>: [</code><code class="line">    [<span class="string">&#39;dev&#39;</span>, <span class="string">&#39;development&#39;</span>, <span class="string">&#39;start&#39;</span>],</code><code class="line">    <span class="string">&#39;serve&#39;</span>,</code><code class="line">  ],</code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">const</span> argv = cli(args)</code><code class="line"></code><code class="line"><span class="comment">// call</span></code><code class="line">./<span class="object">bin</span>.<span class="property">js</span> dev serve</code><code class="line"></code><code class="line"><span class="comment">// <span class="colon">results</span>:</span></code><code class="line">{</code><code class="line">  <span class="colon">cmds</span>: [<span class="string">&#39;dev&#39;</span>, <span class="string">&#39;serve&#39;</span>],</code><code class="line">  <span class="colon">commands</span>: [<span class="string">&#39;dev&#39;</span>, <span class="string">&#39;serve&#39;</span>],</code><code class="line">}</code></pre></div><h3 id="help">help output</h3><p>@magic/cli will derive a help text from your configuration.help itself can be configured to provide better error messages</p><h4 id="help-simple">simple help message</h4><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">import</span> cli from <span class="string">&#39;@magic/cli/src/<span class="object">index</span>.<span class="property">mjs</span>&#39;</span><span class="string">&#39;&#39;</span></code><code class="line"></code><code class="line"><span class="keyword">const</span> args = {</code><code class="line">  <span class="colon">commands</span>: [[<span class="string">&#39;magic&#39;</span>, <span class="string">&#39;m&#39;</span>]],</code><code class="line">  <span class="colon">options</span>: [[<span class="string">&#39;--spell&#39;</span>, <span class="string">&#39;-s&#39;</span>]],</code><code class="line">  <span class="colon">env</span>: [[[<span class="string">&#39;dev&#39;</span>, <span class="string">&#39;development&#39;</span>], <span class="string">&#39;NODE_ENV&#39;</span>, <span class="string">&#39;development&#39;</span>]],</code><code class="line">  <span class="colon">prepend</span>: <span class="string">&#39;prepend&#39;</span>,</code><code class="line">  <span class="colon">append</span>: <span class="string">&#39;append&#39;</span>,</code><code class="line">  <span class="colon">help</span>: <span class="string">&#39;custom help text&#39;</span>,</code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">const</span> argv = cli(args)</code><code class="line"></code><code class="line"><span class="comment">// running</span></code><code class="line">./<span class="object">bin</span>.<span class="property">js</span></code><code class="line"><span class="comment">// without arguments</span></code><code class="line"></code><code class="line"><span class="comment">// help output</span></code><code class="line">`</code><code class="line">@magic/cli wrapped <span class="object">cli</span>.</code><code class="line"></code><code class="line">custom help text</code><code class="line"></code><code class="line">cli commands</code><code class="line">magic - <span class="colon">aliases</span>: [<span class="string">&#39;m&#39;</span>]</code><code class="line"></code><code class="line"></code><code class="line">possible command line <span class="colon">flags</span>:</code><code class="line">--spell - <span class="colon">aliases</span>: [<span class="string">&#39;-s&#39;</span>]</code><code class="line"></code><code class="line"></code><code class="line">environment <span class="colon">switches</span>:</code><code class="line"><span class="colon">dev</span>: set NODE_ENV to development - aliases [<span class="string">&#39;development&#39;</span>]</code><code class="line">`</code></pre></div><h4 id="help-detailed">detailed help message</h4><p>the help property will accept an object which maps to the args object</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">import</span> cli from <span class="string">&#39;@magic/cli/src/<span class="object">index</span>.<span class="property">mjs</span>&#39;</span><span class="string">&#39;&#39;</span></code><code class="line"></code><code class="line"><span class="keyword">const</span> args = {</code><code class="line">  <span class="colon">commands</span>: [[<span class="string">&#39;magic&#39;</span>, <span class="string">&#39;m&#39;</span>]],</code><code class="line">  <span class="colon">options</span>: [[<span class="string">&#39;--spell&#39;</span>, <span class="string">&#39;-s&#39;</span>]],</code><code class="line">  <span class="colon">env</span>: [[[<span class="string">&#39;dev&#39;</span>, <span class="string">&#39;development&#39;</span>], <span class="string">&#39;NODE_ENV&#39;</span>, <span class="string">&#39;development&#39;</span>]],</code><code class="line">  <span class="colon">prepend</span>: <span class="string">&#39;prepend&#39;</span>,</code><code class="line">  <span class="colon">append</span>: <span class="string">&#39;append&#39;</span>,</code><code class="line">  <span class="colon">help</span>: {</code><code class="line">    <span class="colon">name</span>: <span class="string">&#39;cli name&#39;</span>,</code><code class="line">    <span class="colon">text</span>: <span class="string">&#39;custom help text&#39;</span>,</code><code class="line">    <span class="colon">commands</span>: {</code><code class="line">      <span class="colon">magic</span>: <span class="string">&#39;magic info help text&#39;</span>,</code><code class="line">    },</code><code class="line">    <span class="colon">options</span>: {</code><code class="line">      <span class="string">&#39;--spell&#39;</span>: <span class="string">&#39;cast a simple spell&#39;</span>,</code><code class="line">    },</code><code class="line">    <span class="colon">env</span>: [<span class="string">&#39;dev&#39;</span>, <span class="string">&#39;set environment to development&#39;</span>],</code><code class="line">  },</code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">const</span> argv = cli(args)</code><code class="line"></code><code class="line"><span class="comment">// running</span></code><code class="line">./<span class="object">bin</span>.<span class="property">js</span></code><code class="line"><span class="comment">// without arguments</span></code><code class="line"></code><code class="line"><span class="comment">// help output</span></code><code class="line">`</code><code class="line">cli name</code><code class="line"></code><code class="line">custom help text</code><code class="line"></code><code class="line"><span class="colon">commands</span>:</code><code class="line">magic - <span class="colon">aliases</span>: [<span class="string">&#39;m&#39;</span>]</code><code class="line"></code><code class="line"><span class="colon">flags</span>:</code><code class="line">--spell - <span class="colon">aliases</span>: [<span class="string">&#39;-s&#39;</span>]</code><code class="line"></code><code class="line">environment <span class="colon">switches</span>:</code><code class="line"><span class="colon">dev</span>: set <span class="object">process</span>.<span class="property">NODE_ENV</span> to development - aliases [<span class="string">&#39;development&#39;</span>]</code><code class="line">`</code></pre></div><h3 id="config">configuration</h3><p>there are some configuration parameters that can be passed to the cli function</p><h4 id="config-pure">pure</h4><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">const</span> args = {</code><code class="line">  <span class="colon">pure</span>: <span class="boolean">false</span>,    <span class="comment">// set to <span class="boolean">true</span> to prevent changes to <span class="object">process</span>.<span class="property">argv</span> and <span class="object">process</span>.<span class="property">env</span></span></code><code class="line">  <span class="colon">pureEnv</span>: <span class="boolean">false</span>, <span class="comment">// set to <span class="boolean">true</span> to prevent changes to <span class="object">process</span>.<span class="property">env</span></span></code><code class="line">  <span class="colon">pureArgv</span>: <span class="boolean">false</span>, <span class="comment">// set to <span class="boolean">true</span> to prevent changes to <span class="object">process</span>.<span class="property">argv</span></span></code><code class="line">}</code><code class="line"></code><code class="line">cli(args)</code></pre></div><h3 id="config-prepend-append">prepend/append</h3><p>process.argv values can be prepended and appended</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">import</span> cli from <span class="string">&#39;@magic/cli/src/<span class="object">index</span>.<span class="property">mjs</span>&#39;</span></code><code class="line"></code><code class="line"><span class="keyword">const</span> args = {</code><code class="line">  <span class="colon">prepend</span>: [<span class="string">&#39;prepended&#39;</span>]</code><code class="line">  <span class="colon">append</span>: [<span class="string">&#39;appended&#39;</span>]</code><code class="line">}</code><code class="line"></code><code class="line">cli(args)</code></pre></div><h4 id="config-default">default</h4><p>use this to set default process.argv key: value pairs that should be set if they are not</p><div class="Pre lines"><div class="menu"><button>copy</button></div><pre><code class="line"><span class="keyword">import</span> cli from <span class="string">&#39;@magic/cli/src/<span class="object">index</span>.<span class="property">mjs</span>&#39;</span><span class="string">&#39;&#39;</span></code><code class="line"></code><code class="line"><span class="keyword">const</span> args = {</code><code class="line">  <span class="colon">options</span>: [</code><code class="line">    [<span class="string">&#39;--<span class="keyword">default</span>-key&#39;</span>],</code><code class="line">  ],</code><code class="line">  <span class="colon">default</span>: {</code><code class="line">    <span class="string">&#39;--<span class="keyword">default</span>-key&#39;</span>: <span class="string">&#39;<span class="keyword">default</span>-value&#39;</span>,</code><code class="line">  },</code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">const</span> argv = cli(args)</code><code class="line"></code><code class="line"><span class="comment">// returns</span></code><code class="line">{</code><code class="line">  <span class="colon">argv</span>: {</code><code class="line">    <span class="string">&#39;--<span class="keyword">default</span>-key&#39;</span>: <span class="string">&#39;<span class="keyword">default</span>-value&#39;</span>,</code><code class="line">  },</code><code class="line">}</code></pre></div><h2 id="changelog">changelog</h2><h3>0.0.3</h3><p>error if spawned process errors. (process.exit(1)</p><h3>0.0.4</h3><p>console output now aligns</p><h3>0.0.5</h3><p>node 12.4.0 does not have --experimental-node-modules flag.</p><h3>0.0.6</h3><p>readd --experimental-node-modules flag for 13.1.0+</p><h3>0.0.7</h3><p>bump node version</p><p>update @magic/log</p><h3>0.0.8</h3><p>help is shown if commands exist but none are given</p><h3>0.0.9</h3><p>update dependencies</p><h3>0.0.10</h3><p>update dependencies</p><h2 id="source">source</h2><p>the source for this page is in the <a href="https://github.com/magic/cli/tree/master/example" target="_blank" rel="noopener">example directory</a> and gets built and published to github using <a href="https://github.com/magic/core" target="_blank" rel="noopener">@magic/core</a></p></div><footer class="Footer"><div class="Container"><div class="Credits">made with a few bits of <a target="_blank" rel="noopener" href="https://github.com/magic/core">magic</a></div></div></footer></div></main><script src="/cli/magic.js?TcosMuRcYm" integrity="sha384-TcosMuRcYmJ1mKGYY64Gv7oqhHWpYXwP80IOjM4lu7V6rfg0stxmC96BKrkP0lCD" crossorigin="anonymous"></script></body></html>