<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><link rel="icon" href="/cli/favicon.ico"/><link rel="stylesheet" href="/cli/magic.css"/></head><body><div id="magic"><div class="wrapper"><header class="main"><a class="logo-wrapper" href="/cli/"><span class="logo-text">@magic/cli</span></a><nav class="Menu"><ul><li><a href="/cli/#dependencies">dependencies</a></li><li><a href="/cli/#install">install</a></li><li><a href="/cli/#caveats">caveats</a></li><li><a href="/cli/#usage">usage</a></li><li><a href="/cli/#argv">argv</a></li><li><a href="/cli/#commands">commands</a></li><li><a href="/cli/#help">help</a></li><li><a href="/cli/#configuration">config</a></li></ul></nav></header><div class="page"><h2>@magic/cli</h2><p>declarative cli sanitization and execution for [@magic](https://magic.github.io/cli)</p><p>sanitizes cli flags from aliases to default names</p><p>rewrites process.argv accordingly</p><p>provides autogenerated --help output (that can be customized)</p><p>also handles commands and environment for you</p><p><a href="https://magic.github.io/cli/" target="_blank" rel="noopener">html-docs</a></p><ul class="GitBadges"><li><a href="https://www.npmjs.com/package/@magic/cli" target="_blank" rel="noopener"><img src="https://img.shields.io/npm/v/@magic/cli.svg" role="presentation" alt=""/></a></li><li><a href="https://travis-ci.com/magic/cli" target="_blank" rel="noopener"><img src="https://travis-ci.com/magic/cli.svg?branch=master" role="presentation" alt=""/></a></li><li><a href="https://ci.appveyor.com/project/jaeh/cli/branch/master" target="_blank" rel="noopener"><img src="https://img.shields.io/appveyor/ci/jaeh/cli/master.svg" role="presentation" alt=""/></a></li><li><a href="https://coveralls.io/github/magic/cli" target="_blank" rel="noopener"><img src="https://coveralls.io/repos/github/magic/cli/badge.svg" role="presentation" alt=""/></a></li><li><a href="https://greenkeeper.io" target="_blank" rel="noopener"><img src="https://badges.greenkeeper.io/magic/cli.svg" role="presentation" alt=""/></a></li><li><a href="https://snyk.io/test/github/magic/cli" target="_blank" rel="noopener"><img src="https://snyk.io/test/github/magic/cli/badge.svg" role="presentation" alt=""/></a></li></ul><h3 id="dependencies">dependencies:</h3><p><a href="https://github.com/magic/log" target="_blank" rel="noopener">@magic/log</a>: console.log wrapper with loglevels</p><p><a href="https://github.com/magic/types" target="_blank" rel="noopener">@magic/types</a>: type checking library</p><p>@magic/log and @magic/types have no dependencies.</p><h3 id="install">install</h3><p>be in a nodejs project</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line">npm<span class="keyword"> </span><span class="keyword">i</span> --save-dev @magic/cli</code></pre></div><h3 id="caveats">caveats</h3><p>there are some quirks that need some careful consideration when designing a cli api depending on your requirements, these caveats should seldomly apply.</p><ol><li><h5>last argument</h5><p>if your last argument does not have a corresponding flag, it will still be assigned to the last flag prior to it.</p></li><li><h5>option argument and command name clash</h5><p>if one of your options gets an argument that is equal to a command,  this command will be executed</p></li><li><h5>flag arguments can not start with a dash</h5><p>cli arguments that start with a - will always be treated as flags, not values.</p></li></ol><p>those issues might get addressed in the future.</p><h3 id="usage">Usage</h3><p>full api example</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><code class="line comment">// ./bin.js</code></code><code class="line"></code><code class="line">#!/usr/bin/env<span class="keyword"> </span>node</code><code class="line"><span class="keyword">const</span><span class="keyword"> </span>cli = <span class="keyword">require</span>(<span class="string">&#39;@magic/cli&#39;</span>)</code><code class="line"></code><code class="line"><span class="keyword">const</span> { argv, env, commands } = cli({</code><code class="line">  <span class="colon">commands</span>: [</code><code class="line">    [<span class="string">&#39;cmd1&#39;</span>, <span class="string">&#39;cmd1alias&#39;</span>],</code><code class="line">    <span class="string">&#39;cmd2&#39;</span>,</code><code class="line">  ],</code><code class="line">  <span class="colon">options</span>: [</code><code class="line">    [<span class="string">&#39;--flag1&#39;</span>, <span class="string">&#39;-f1&#39;</span>],</code><code class="line">    [<span class="string">&#39;--flag2&#39;</span>, <span class="string">&#39;-f2&#39;</span>],</code><code class="line">  ],</code><code class="line">  <span class="colon">default</span>: [</code><code class="line">    [<span class="string">&#39;--default-key&#39;</span>, <span class="string">&#39;default-value&#39;</span>],</code><code class="line">  ],</code><code class="line">  <span class="colon">env</span>: [[[<span class="string">&#39;--production&#39;</span>, <span class="string">&#39;--prod&#39;</span>, <span class="string">&#39;--p&#39;</span>, <span class="string">&#39;-p&#39;</span>], <span class="string">&#39;NODE_ENV&#39;</span>, <span class="string">&#39;production&#39;</span>]],</code><code class="line"><code class="line">  <span class="colon">pure</span>: <span class="boolean">true</span>, <code class="comment">// do neither change process.argv nor process.env</code></code></code><code class="line"><code class="line">  <span class="colon">pureArgv</span>: <span class="boolean">true</span>, <code class="comment">// do not change process.argv</code></code></code><code class="line"><code class="line">  <span class="colon">pureEnv</span>: <span class="boolean">true</span>, <code class="comment">// do not change process.env</code></code></code><code class="line">})</code></pre></div><h3 id="argv">options / argv</h3><p>argv mappings will handle options and option aliases</p><p>using the <a href="/cli/#usage">cli file</a> above</p><p>then, in your terminal / bash</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="object">bin</span>.<span class="property">js</span> -f1<span class="keyword"> </span>arg1<span class="keyword"> </span>arg2 -f2</code></pre></div><p>resulting process.argv</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="object">process</span>.<span class="property">argv</span> = [</code><code class="line">  <span class="string">&#39;/path/to/bin/node&#39;</span>,</code><code class="line">  <span class="string">&#39;/path/to/bin.js&#39;</span>,</code><code class="line">  <span class="string">&#39;--flag1&#39;</span></code><code class="line">  <span class="string">&#39;arg1&#39;</span>,</code><code class="line">  <span class="string">&#39;arg2&#39;</span>,</code><code class="line">  <span class="string">&#39;--flag2&#39;</span>,</code><code class="line">]</code></pre></div><p>returned javascript object</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line">argv === { <span class="string">&#39;--flag1&#39;</span>: [<span class="string">&#39;arg1&#39;</span>, arg2], <span class="string">&#39;--flag2&#39;</span>: []}</code></pre></div><h3 id="commands">commands</h3><p>cli commands can be handled too.</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span><span class="keyword"> </span>cli = <span class="keyword">require</span>(<span class="string">&#39;@magic/cli&#39;</span>)</code><code class="line"></code><code class="line"><span class="keyword">const</span><span class="keyword"> </span>args = {</code><code class="line">  <span class="colon">commands</span>: [</code><code class="line">    [<span class="string">&#39;dev&#39;</span>, <span class="string">&#39;development&#39;</span>, <span class="string">&#39;start&#39;</span>],</code><code class="line">    <span class="string">&#39;serve&#39;</span>,</code><code class="line">  ],</code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">const</span><span class="keyword"> </span>argv = cli(args)</code><code class="line"></code><code class="line"><code class="line comment">// call</code></code><code class="line">./<span class="object">bin</span>.<span class="property">js</span><span class="keyword"> </span>dev<span class="keyword"> </span>serve</code><code class="line"></code><code class="line"><code class="line comment">// results:</code></code><code class="line">{</code><code class="line">  <span class="colon">cmds</span>: [<span class="string">&#39;dev&#39;</span>, <span class="string">&#39;serve&#39;</span>],</code><code class="line">  <span class="colon">commands</span>: [<span class="string">&#39;dev&#39;</span>, <span class="string">&#39;serve&#39;</span>],</code><code class="line">}</code></pre></div><h3 id="help">help output</h3><p>@magic/cli will derive a help text from your configuration.help itself can be configured to provide better error messages</p><h4 id="help-simple">simple help message</h4><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span><span class="keyword"> </span>cli = <span class="keyword">require</span>(<span class="string">&#39;@magic/cli&#39;</span>)</code><code class="line"></code><code class="line"><span class="keyword">const</span><span class="keyword"> </span>args = {</code><code class="line">  <span class="colon">commands</span>: [[<span class="string">&#39;magic&#39;</span>, <span class="string">&#39;m&#39;</span>]],</code><code class="line">  <span class="colon">options</span>: [[<span class="string">&#39;--spell&#39;</span>, <span class="string">&#39;-s&#39;</span>]],</code><code class="line">  <span class="colon">env</span>: [[[<span class="string">&#39;dev&#39;</span>, <span class="string">&#39;development&#39;</span>], <span class="string">&#39;NODE_ENV&#39;</span>, <span class="string">&#39;development&#39;</span>]],</code><code class="line">  <span class="colon">prepend</span>: <span class="string">&#39;prepend&#39;</span>,</code><code class="line">  <span class="colon">append</span>: <span class="string">&#39;append&#39;</span>,</code><code class="line">  <span class="colon">help</span>: <span class="string">&#39;custom help text&#39;</span>,</code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">const</span><span class="keyword"> </span>argv = cli(args)</code><code class="line"></code><code class="line"><code class="line comment">// running</code></code><code class="line">./<span class="object">bin</span>.<span class="property">js</span></code><code class="line"><code class="line comment">// without arguments</code></code><code class="line"></code><code class="line"><code class="line comment">// help output</code></code><code class="line">`</code><code class="line">@magic/cli<span class="keyword"> </span>wrapped<span class="keyword"> </span><span class="object">cli</span>.</code><code class="line"></code><code class="line">custom<span class="keyword"> </span>help<span class="keyword"> </span>text</code><code class="line"></code><code class="line">cli<span class="keyword"> </span>commands</code><code class="line">magic - <span class="colon">aliases</span>: [<span class="string">&#39;m&#39;</span>]</code><code class="line"></code><code class="line"></code><code class="line">possible<span class="keyword"> </span>command<span class="keyword"> </span>line<span class="keyword"> </span><span class="colon">flags</span>:</code><code class="line">--spell - <span class="colon">aliases</span>: [<span class="string">&#39;-s&#39;</span>]</code><code class="line"></code><code class="line"></code><code class="line">environment<span class="keyword"> </span><span class="colon">switches</span>:</code><code class="line"><span class="colon">dev</span>: <span class="builtin">set</span><span class="keyword"> </span>NODE_ENV<span class="keyword"> </span><span class="keyword">to</span><span class="keyword"> </span>development - aliases [<span class="string">&#39;development&#39;</span>]</code><code class="line">`</code></pre></div><h4 id="help-detailed">detailed help message</h4><p>the help property will accept an object which maps to the args object</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span><span class="keyword"> </span>cli = <span class="keyword">require</span>(<span class="string">&#39;@magic/cli&#39;</span>)</code><code class="line"></code><code class="line"><span class="keyword">const</span><span class="keyword"> </span>args = {</code><code class="line">  <span class="colon">commands</span>: [[<span class="string">&#39;magic&#39;</span>, <span class="string">&#39;m&#39;</span>]],</code><code class="line">  <span class="colon">options</span>: [[<span class="string">&#39;--spell&#39;</span>, <span class="string">&#39;-s&#39;</span>]],</code><code class="line">  <span class="colon">env</span>: [[[<span class="string">&#39;dev&#39;</span>, <span class="string">&#39;development&#39;</span>], <span class="string">&#39;NODE_ENV&#39;</span>, <span class="string">&#39;development&#39;</span>]],</code><code class="line">  <span class="colon">prepend</span>: <span class="string">&#39;prepend&#39;</span>,</code><code class="line">  <span class="colon">append</span>: <span class="string">&#39;append&#39;</span>,</code><code class="line">  <span class="colon">help</span>: {</code><code class="line">    <span class="colon">name</span>: <span class="string">&#39;cli name&#39;</span>,</code><code class="line">    <span class="colon">text</span>: <span class="string">&#39;custom help text&#39;</span>,</code><code class="line">    <span class="colon">commands</span>: {</code><code class="line">      <span class="colon">magic</span>: <span class="string">&#39;magic info help text&#39;</span>,</code><code class="line">    },</code><code class="line">    <span class="colon">options</span>: {</code><code class="line">      <span class="string">&#39;--spell&#39;</span>: <span class="string">&#39;cast a simple spell&#39;</span>,</code><code class="line">    },</code><code class="line">    <span class="colon">env</span>: [<span class="string">&#39;dev&#39;</span>, <span class="string">&#39;set environment to development&#39;</span>],</code><code class="line">  },</code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">const</span><span class="keyword"> </span>argv = cli(args)</code><code class="line"></code><code class="line"><code class="line comment">// running</code></code><code class="line">./<span class="object">bin</span>.<span class="property">js</span></code><code class="line"><code class="line comment">// without arguments</code></code><code class="line"></code><code class="line"><code class="line comment">// help output</code></code><code class="line">`</code><code class="line">cli<span class="keyword"> </span>name</code><code class="line"></code><code class="line">custom<span class="keyword"> </span>help<span class="keyword"> </span>text</code><code class="line"></code><code class="line"><span class="colon">commands</span>:</code><code class="line">magic - <span class="colon">aliases</span>: [<span class="string">&#39;m&#39;</span>]</code><code class="line"></code><code class="line"><span class="colon">flags</span>:</code><code class="line">--spell - <span class="colon">aliases</span>: [<span class="string">&#39;-s&#39;</span>]</code><code class="line"></code><code class="line">environment<span class="keyword"> </span><span class="colon">switches</span>:</code><code class="line"><span class="colon">dev</span>: <span class="builtin">set</span><span class="keyword"> </span><span class="object">process</span>.<span class="property">NODE_ENV</span><span class="keyword"> </span><span class="keyword">to</span><span class="keyword"> </span>development - aliases [<span class="string">&#39;development&#39;</span>]</code><code class="line">`</code></pre></div><h3 id="config">configuration</h3><p>there are some configuration parameters that can be passed to the cli function</p><h4 id="configuration-pure">pure</h4><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span><span class="keyword"> </span>args = {</code><code class="line"><code class="line">  <span class="colon">pure</span>: <span class="boolean">false</span>,    <code class="comment">// set to true to prevent changes to process.argv and process.env</code></code></code><code class="line"><code class="line">  <span class="colon">pureEnv</span>: <span class="boolean">false</span>, <code class="comment">// set to true to prevent changes to process.env</code></code></code><code class="line"><code class="line">  <span class="colon">pureArgv</span>: <span class="boolean">false</span>, <code class="comment">// set to true to prevent changes to process.argv</code></code></code><code class="line">}</code><code class="line"></code><code class="line">cli(args)</code></pre></div><h3 id="prepend-append">prepend/append</h3><p>process.argv values can be prepended and appended</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span><span class="keyword"> </span>cli = <span class="keyword">require</span>(<span class="string">&#39;@magic/cli)&#39;</span></code><code class="line"></code><code class="line"><span class="keyword">const</span><span class="keyword"> </span>args = {</code><code class="line">  <span class="colon">prepend</span>: [<span class="string">&#39;prepended&#39;</span>]</code><code class="line">  <span class="colon">append</span>: [<span class="string">&#39;appended&#39;</span>]</code><code class="line">}</code><code class="line"></code><code class="line">cli(args)</code></pre></div><h4 id="default">default</h4><p>use this to set default process.argv key: value pairs that should be set if they are not</p><div class="Pre light"><div class="menu"><button>dark</button><button>copy</button></div><pre><code class="line"><span class="keyword">const</span><span class="keyword"> </span>cli = <span class="keyword">require</span>(<span class="string">&#39;@magic/cli&#39;</span>)</code><code class="line"></code><code class="line"><span class="keyword">const</span><span class="keyword"> </span>args = {</code><code class="line">  <span class="colon">options</span>: [</code><code class="line">    [<span class="string">&#39;--default-key&#39;</span>],</code><code class="line">  ],</code><code class="line">  <span class="colon">default</span>: [</code><code class="line">    [<span class="string">&#39;--default-key&#39;</span>, <span class="string">&#39;default-value&#39;</span>]</code><code class="line">  ],</code><code class="line">}</code><code class="line"></code><code class="line"><span class="keyword">const</span><span class="keyword"> </span>argv = cli(args)</code><code class="line"></code><code class="line"><code class="line comment">// returns</code></code><code class="line">{</code><code class="line">  <span class="colon">argv</span>: {</code><code class="line">    <span class="string">&#39;--default-key&#39;</span>: <span class="string">&#39;default-value&#39;</span>,</code><code class="line">  },</code><code class="line">}</code></pre></div></div><footer class="main"><div class="wrapper">made with a few bits of <a target="_blank" rel="noopener" href="https://github.com/magic/core">magic</a></div></footer></div></div><script type="text/javascript" src="/cli/magic.js"></script></body></html>